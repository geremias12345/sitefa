{% extends 'inicio/inicio.html' %}

{% block section %}
<section class="max-w-4xl mx-auto mt-10 bg-panel text-text shadow-2xl rounded-3xl p-8 transition-all">

    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-indigo-700 dark:text-indigo-300 flex items-center gap-2">
            <i class="fa-solid fa-clipboard-user text-indigo-500"></i> 
            Registrar Asistencia
        </h1>

        <a href="{% url 'asistencia:asistencia_leer' %}"
           class="inline-flex items-center gap-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium px-4 py-2 rounded-lg transition shadow-md">
            <i class="fas fa-arrow-left"></i> Volver
        </a>
    </div>

    <hr class="border-gray-300 dark:border-gray-700 mb-6">

    <form method="get" class="mb-6">
        <label for="id_materia" class="block text-lg font-semibold text-text mb-2">
            Seleccionar Materia:
        </label>
        <select name="materia" id="id_materia" 
                class="w-full md:w-1/2 px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-gray-100 dark:bg-gray-800 text-text focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition" 
                onchange="this.form.submit()">
            <option value="">--- Seleccione una Materia ---</option>
            {% for m in materias %}
                <option value="{{ m.id }}" {% if selected_materia == m.id|stringformat:"s" %}selected{% endif %}>
                    {{ m.nombre }}
                </option>
            {% endfor %}
        </select>
    </form>

    {% if estudiantes %}
    <form method="post" class="space-y-6">
        {% csrf_token %}

        <div>
            <label for="id_fecha" class="block text-sm font-semibold text-text mb-1">Fecha:</label>
            <input type="date" name="fecha" id="id_fecha" 
                   class="w-full md:w-1/3 px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg **bg-gray-700 text-white** cursor-default" 
                   value="{{ today }}" readonly>
        </div>

        <div class="border border-indigo-400 dark:border-indigo-600 rounded-lg p-4 bg-gray-100 dark:bg-gray-800">
            <label class="block text-sm font-bold **text-gray-800 dark:text-white** mb-3">
                Estudiantes **Ausentes** (Marcar a quienes **NO** asistieron):
            </label>
            
            <div class="max-h-64 overflow-y-auto pr-2 space-y-2">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-2">
                    {% for est in estudiantes %}
                        <div class="flex items-center">
                            <input class="w-4 h-4 text-indigo-600 bg-gray-200 border-gray-300 rounded focus:ring-indigo-500 dark:focus:ring-indigo-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600" 
                                   type="checkbox" 
                                   name="ausentes" 
                                   id="est{{ est.id }}" 
                                   value="{{ est.id }}">
                            <label class="ml-2 text-sm font-medium text-gray-700 dark:text-white" for="est{{ est.id }}">
                                {{ est.apellido }}, {{ est.nombre }}
                            </label>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div>
            <label for="id_justificacion" class="block text-sm font-semibold text-text mb-1">Justificaci√≥n (opcional):</label>
            <input type="text" name="justificacion" id="id_justificacion" 
                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-gray-100 dark:bg-gray-800 text-text focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition" 
                   placeholder="Ej: enfermedad, viaje, etc.">
        </div>

        <input type="hidden" name="materia" value="{{ selected_materia }}">

        <div class="flex justify-end pt-4">
            <button type="submit"
                    class="px-6 py-2 rounded-lg bg-yellow-500 hover:bg-yellow-600 text-white font-semibold shadow-md transition">
                <i class="fas fa-save mr-2"></i> Registrar Asistencia
            </button>
        </div>
    </form>
    {% else %}
        {% if selected_materia %}
            <p class="text-gray-600 dark:text-gray-400 italic mt-4">
                No hay estudiantes registrados en la materia seleccionada.
            </p>
        {% else %}
            <p class="text-gray-600 dark:text-gray-400 italic mt-4">
                Por favor, selecciona una materia para registrar la asistencia.
            </p>
        {% endif %}
    {% endif %}
</section>
{% endblock section %}