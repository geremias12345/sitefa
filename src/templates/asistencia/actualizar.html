{% extends 'inicio/inicio.html' %}
{% load static %}

{% block section %}
<section class="max-w-3xl mx-auto mt-10 bg-panel text-text shadow-2xl rounded-3xl p-8 transition-all">

    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-indigo-700 dark:text-indigo-300 flex items-center gap-2">
             Editar Registro de Asistencia
        </h1>

        <a href="{% url 'asistencia:asistencia_leer' %}"
           class="inline-flex items-center gap-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium px-4 py-2 rounded-lg transition">
            <i class="fas fa-arrow-left"></i> Volver
        </a>
    </div>

    <hr class="border-gray-300 dark:border-gray-700 mb-6">

    <div class="rounded-xl p-5 mb-6 text-text border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800">
        <div class="font-bold text-text mb-3 border-b pb-2 border-gray-300 dark:border-gray-700">
            Detalles de la Asistencia
        </div>
        <p class="mb-2">
            <i class="fas fa-user-graduate w-4 mr-2 text-indigo-500"></i> 
            <strong>Estudiante:</strong> {{ object.estudiante.apellido }}, {{ object.estudiante.nombre }}
        </p>
        <p class="mb-2">
            <i class="fas fa-book w-4 mr-2 text-indigo-500"></i> 
            <strong>Materia:</strong> {{ object.materia.nombre }} ({{ object.materia.anio }}º Año)
        </p>
        <p class="mb-0">
            <i class="fas fa-calendar-alt w-4 mr-2 text-indigo-500"></i> 
            <strong>Fecha:</strong> {{ object.fecha|date:"d/m/Y" }}
        </p>
    </div>

    <form method="post" class="space-y-6">
        {% csrf_token %}
        
        {% with es_presente=object.presente %}
        <div class="p-0 rounded-xl transition-all">
            <label class="block font-bold text-sm mb-3">Estado de la Asistencia:</label>
            
            <div class="flex items-center">
                <label class="relative inline-flex items-center cursor-pointer mr-4">
                    <input type="hidden" name="presente" value="False">
                    
                    <input 
                        type="checkbox" 
                        name="presente" 
                        id="id_presente" 
                        value="True" 
                        class="sr-only peer"
                        {% if es_presente %}checked{% endif %}
                    >
                    
                    <div class="w-14 h-7 bg-gray-400 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-500 peer-checked:bg-green-600"></div>
                </label>
                
                <span class="text-xl font-semibold transition-colors 
                    {% if es_presente %}text-green-600 dark:text-green-400{% else %}text-red-600 dark:text-red-400{% endif %}"
                >
                    Actualmente: 
                    <strong>
                        {% if es_presente %}PRESENTE{% else %}AUSENTE (FALTA){% endif %}
                    </strong>
                </span>
            </div>
        </div>
        {% endwith %}

        <div>
            <label for="id_justificacion" class="block text-sm font-semibold text-text mb-1">
                <i class="fas fa-pencil-alt mr-1"></i> Justificación (Obligatoria si es AUSENTE):
            </label>
            <textarea 
                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-gray-100 dark:bg-gray-800 text-text focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition" 
                name="justificacion" 
                id="id_justificacion" 
                rows="3"
                placeholder="Indique el motivo de la ausencia, si aplica."
            >{{ object.justificacion|default_if_none:"" }}</textarea>
            
            {% if form.justificacion.errors %}
                <div class="mt-2 p-3 bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300 border border-red-300 dark:border-red-700 rounded-lg text-sm">
                    {{ form.justificacion.errors }}
                </div>
            {% endif %}
        </div>

        <div class="flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700">
            <a href="{% url 'asistencia:asistencia_leer' %}"
               class="px-5 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition shadow-md">
                Cancelar
            </a>
            <button type="submit"
                    class="px-6 py-2 rounded-lg bg-yellow-500 hover:bg-yellow-600 text-white font-semibold shadow-md transition">
                <i class="fas fa-save mr-2"></i> Guardar Cambios
            </button>
        </div>
    </form>
</section>
{% endblock section %}